<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<meta name="viewport" content="width=device-width, initial-sale=1"/>

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
    <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

	<link href='fullcalendar/main.css' rel='stylesheet' />
    <script src='fullcalendar/main.js'></script>

    <script>
        const resizeMain = () => {
            let headerHeight = Number($('#header').css('height').substring(0, $('#header').css('height').length-2));
            let sideTitleHeight = Number($('#sideTitle').css('height').substring(0, $('#sideTitle').css('height').length-2));
            let sideMonthHeight = Number($('#sideMonth').css('height').substring(0, $('#sideMonth').css('height').length-2))
            $('#sidebar').css('height', window.innerHeight-Number($('#header').css('height').substring(0, $('#header').css('height').length-2)));
            $('#sideMain').css('height', window.innerHeight-headerHeight-sideTitleHeight-sideMonthHeight);

            let sidebarWidth = Number($('#sidebar').css('width').substring(0, $('#sidebar').css('width').length-2));
            $('#contentsBack').css('height', window.innerHeight-headerHeight);
            $('#contentsBack').css('width', window.innerWidth-sidebarWidth-17);

            // let calwidth = screen.availWidth-sidebarWidth-380;
            let calwidth = window.innerWidth-sidebarWidth-250;
            $('#contents').css('height', window.innerHeight-headerHeight-60);
            $('#contents').css('width', calwidth);

            calendar.render();
        };

        let event = [
            {
                title: '가족여행',
                start: '2022-02-02',
                end: '2022-02-07',
                color: '#ddd',
                textColor: 'white',
                place: 'hhhh',
                text: 'hehehehehehehe'
            },
            {
                title: '하하하',
                start: '2022-02-04',
                end: '2022-02-11'
            },
            {
                title: '후후후',
                start: '2022-02-14',
                end: '2022-02-20'
            },
            {
                title: '으얅얅앍앍앍',
                start: '2022-02-15',
                end: '2022-02-22',
                color: 'green',
                textColor: 'white',
                place: 'hhhh',
                text: 'hehehehehehehe'
            }
        ];

        const setSideMain = () => {
            let eventOfday = [];
            for(let i = 1; i<=31; i++){
                eventOfday[i] = [];
                for(let j = 0; j < event.length; j++){
                    let start = Number(event[j].start.substring(8));
                    let end = Number(event[j].end.substring(8)-1)
                    if(i>=start && i<=end){
                        eventOfday[i].push(event[j].title);
                    }
                }
            }

            let eventListHTML = "";
            for(let i = 1; i<=31; i++){
                if(eventOfday[i].length!=0){
                    eventListHTML +=
                    "<div class='dayList'>" +
                    "<div class=\"card-header\" data-target=\"#list"+i+"\" data-toggle=\"collapse\">"+i+"일</div>"+
                    "<div id=\"list"+i+"\" class=\"collapse\" data-parent=\"#listbox\">" +
                    "<ul class=\"eventList\">";
                    
                    for(let j = 0; j < eventOfday[i].length; j++){
                        eventListHTML +=
                        "<li>"+eventOfday[i][j]+"</li>";
                    }
                    eventListHTML +="</ul></div></div>";
                }
            }
            document.querySelector('#listbox').innerHTML = eventListHTML;
        }

        const hello = () => {
            alert("hello");
        }

        const changeMonth = () => {
            $("#sideMonth>span").text(calendar.getDate().getFullYear()+"년 " + (calendar.getDate().getMonth() + 1) + "월");
            setSideMain();
            calendar.render();
        };
        const nextMonth = () => {
            calendar.next();
            changeMonth();
        };
        const prevMonth = () => {
            calendar.prev();
            changeMonth();
        };

        document.addEventListener('DOMContentLoaded', function() {
            changeMonth();
            $(".fc-toolbar-chunk button").click(changeMonth);

            resizeMain();
            $(window).resize(resizeMain);
        });

    </script>
    <link rel="stylesheet" href="css/home.css">
</head>
<body>
	<div id="header">
		<div id="icons">
            <a href="index.html" class="disableLink"><i class="bi bi-house-fill" title="Home"></i></a>
            <a href="test.html"><i class="bi bi-person-lines-fill" title="Friends"></i></a>
            <a href="#"><i class="bi bi-people-fill" title="Group"></i></a>
            <a href="#"><i class="bi bi-megaphone-fill" title="Announcement"></i></a>
		</div>
	</div>
	<div id="main">
        <div id="sidebar">
            <div id="sideTitle">
                <span>일정 목록</span>
                <i class="bi bi-calendar-plus"></i>
            </div>

            <div id="sideMonth">
                <a href="#" onclick="prevMonth()">◁</a>
                <span></span> 
                <a href="#" onclick="nextMonth()">▷</a>
            </div>

            <div id="sideMain">
                <div id="listbox">
                </div>
            </div>
        </div>
        <div id="contentsBack">
            <div id=contents>
                <div id='usercode'>Usercode: 이현수#0000</div>
                <div id='calendar'></div>
                <script src="js/myCalendar.js"></script>
            </div>
        </div>
    </div>
</body>
</html>